import streamlit as st
import pandas as pd
import plotly.express as px

# --- 1. CONFIGURATION DE LA PAGE ---
st.set_page_config(page_title="Dashboard Ventes Pharma", layout="wide")

# Style CSS pour un rendu √©pur√© et professionnel
st.markdown("""
    <style>
    .main { background-color: #ffffff; }
    h1 { color: #555555; text-align: center; font-family: sans-serif; font-size: 28px; margin-bottom: 30px; }
    </style>
    """, unsafe_allow_html=True)

# --- 2. PR√âPARATION DES DONN√âES ANALYS√âES ---

# Palette de couleurs exacte (extraite de vos images)
colors = {
    'Produit N02BE': '#1a5d7d', # Bleu canard fonc√©
    'Produit N05B': '#e87c3e',  # Orange
    'Produit R03': '#1c6328',   # Vert for√™t
    'Produit M01AB': '#0099d4', # Bleu cyan
    'Produit M01AE': '#a12c8a', # Magenta / Prune
    'Produit N02BA': '#5ab23d', # Vert pomme
    'Produit R06': '#0d344d',   # Bleu marine nuit
    'Produit N05C': '#8e3e15'   # Marron terre
}

# Donn√©es analys√©es du graphique "Evolution des ventes par an" (estimations pr√©cises pixel par pixel)
data_evolution = pd.DataFrame({
    'Ann√©e': [2014, 2015, 2016, 2017, 2018, 2019],
    'Produit N02BE': [10100, 11950, 13400, 7650, 11250, 7980],
    'Produit N05B': [4350, 3020, 3280, 2120, 3240, 2430],
    'Produit R03': [1250, 1850, 2180, 1780, 2760, 2120],
    'Produit M01AB': [1520, 1840, 2160, 1580, 1820, 1510],
    'Produit M01AE': [1340, 1510, 1620, 1240, 1480, 1150],
    'Produit N02BA': [1680, 1520, 1650, 1120, 1050, 840],
    'Produit R06': [820, 980, 1050, 890, 1240, 1120],
    'Produit N05C': [210, 240, 280, 210, 260, 220]
}).melt(id_vars='Ann√©e', var_name='Produit', value_name='Ventes')

# Donn√©es analys√©es du graphique "R√©partition" (pourcentages exacts de l'image)
data_pie = pd.DataFrame({
    'Produit': ['N02BE', 'N05B', 'R03', 'M01AB', 'M01AE', 'N02BA', 'R06', 'N05C'],
    'Pourcentage': [49, 15, 9, 8, 7, 6, 5, 1]
})

# Donn√©es analys√©es du graphique "Moyenne" (valeurs pr√©cises du tableau)
data_moyenne = pd.DataFrame({
    'Mois': ['janv', 'f√©vr', 'mars', 'avr', 'mai', 'juin', 'juil', 'ao√ªt', 'sept', 'oct', 'nov', 'd√©c'],
    'Quantit√©s': [11324.8, 11351.0, 11433.6, 10388.3, 9994.7, 9074.7, 8806.4, 9150.8, 11050.4, 13196.7, 9637.3, 11177.0]
})

# --- 3. CR√âATION DES GRAPHIQUES ---

# A. Evolution des ventes par an
fig_evol = px.bar(
    data_evolution, x='Ann√©e', y='Ventes', color='Produit',
    color_discrete_map=colors,
    category_orders={"Produit": list(colors.keys())[::-1]} # Empilement correct (N02BE en bas)
)
fig_evol.update_layout(
    title="Evolution des ventes par an",
    plot_bgcolor='white',
    yaxis=dict(range=[0, 30000], gridcolor='#e5e5e5', title=""),
    xaxis=dict(tickmode='linear', showgrid=False, title=""),
    legend=dict(title="", traceorder="normal")
)

# B. R√©partition de la vente des produits
# On recr√©e les cl√©s sans "Produit " pour le camembert
pie_colors = {k.replace("Produit ", ""): v for k, v in colors.items()}
fig_pie = px.pie(
    data_pie, values='Pourcentage', names='Produit',
    color='Produit', color_discrete_map=pie_colors
)
fig_pie.update_traces(
    textposition='outside', 
    textinfo='label+percent',
    pull=[0.02]*8, # L√©ger espacement
    marker=dict(line=dict(color='#FFFFFF', width=2))
)
fig_pie.update_layout(
    title="R√âPARTITION DE LA VENTE DES PRODUITS",
    title_x=0.5,
    title_font=dict(size=24, color='#555555'),
    showlegend=False
)

# C. Quantit√©s vendues par mois en moyenne
fig_moy = px.line(data_moyenne, x='Mois', y='Quantit√©s')
fig_moy.update_traces(line_color='#1b5e78', line_width=5)
fig_moy.update_layout(
    title="Quantit√©s vendu par mois en moyenne",
    title_x=0.5,
    title_font=dict(size=24, color='#555555'),
    plot_bgcolor='white',
    yaxis=dict(range=[0, 14000], gridcolor='#e5e5e5', title=""),
    xaxis=dict(showgrid=False, title="")
)

# --- 4. AFFICHAGE DANS STREAMLIT ---

st.markdown("<h1>üìä Dashboard Statistique de Performance des Ventes</h1>", unsafe_allow_html=True)

# Ligne du haut : Evolution et R√©partition
col1, col2 = st.columns([1.3, 1])
with col1:
    st.plotly_chart(fig_evol, use_container_width=True)
with col2:
    st.plotly_chart(fig_pie, use_container_width=True)

st.divider()

# Ligne du bas : Moyenne annuelle
c1, c2, c3 = st.columns([1, 4, 1])
with c2:
    st.plotly_chart(fig_moy, use_container_width=True)
    